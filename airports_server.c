/*
 * This is sample code generated by rpcgen.
 * These are only templates and you can use them
 * as a guideline for developing your own functions.
 */

#include "places.h"
#include "airports.h"
#include <stdio.h>
#include <stdlib.h>

airport_ret *
airports_1_svc(airportdata *argp, struct svc_req *rqstp)
{
  static airport_ret  result;
  printf("in airports server\n");

  FILE *fp;
  fp = fopen("airport-locations.txt", "r");
  if (fp == NULL)
	printf("error opening file\n");

  char line[200];

  while(fgets(line, 200, fp) != NULL) {
	char *comma = strchr(line, ',');
	char *tab = strchr(line, '\t');
	char air[4];
	char latitude[5];
	char longitude[7];
	char city[40];

	if(comma) {
	  strncpy(air, line + 1, 3);
	  air[4] = '\0';

	  strncpy(latitude, line + 6, 5);
	  latitude[5] = '\0';

	  strncpy(longitude, line + 12, 6);
	  longitude[7] = '\0';

	  int comma_pos = comma - tab - 1;
	  int tab_pos = tab - line + 1;

	  strncpy(city, line + tab_pos, comma_pos);
	  city[comma_pos] = '\0';

	}
  }
  
  fclose(fp);
  return &result;
}
